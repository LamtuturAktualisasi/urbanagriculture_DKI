<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">

  <link rel="stylesheet" href="./resources/ol.css">
  <link rel="stylesheet" href="resources/fontawesome-all.min.css">
  <link href="resources/photon-geocoder-autocomplete.min.css" rel="stylesheet">
  <link rel="stylesheet" href="./resources/ol-layerswitcher.css">
  <link rel="stylesheet" href="./resources/qgis2web.css">

  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    #map {
      width: 100vw;
      height: 100vh;
    }

    .ol-control {
      background-color: rgba(255,255,255,0.4)!important;
      padding: 2px !important;
    }

    .ol-control > * {
      background-color: #f8f8f8!important;
      color: #444!important;
      border-radius: 0px;
    }

    .ol-control > *:focus, .ol-control >*:hover {
      background-color: rgba(248, 248, 248, 0.7)!important;
    }

    .layer-switcher {
      top: 10px !important;
      right: 10px !important;
    }

    .legend-container {
      background-color: white;
      padding: 10px;
      position: absolute;
      bottom: 10px;
      left: 10px;
      z-index: 1000;
      border: 1px solid #ccc;
      font-size: 12px;
      max-width: 200px;
    }
  </style>

  <title>Peta Urban Agriculture</title>
</head>
<body>
  <div id="map">
    <div id="popup" class="ol-popup">
      <a href="#" id="popup-closer" class="ol-popup-closer"></a>
      <div id="popup-content"></div>
    </div>
    <div class="legend-container" id="legend"></div>
  </div>

  <!-- SCRIPTS -->
  <script src="resources/qgis2web_expressions.js"></script>
  <script src="./resources/functions.js"></script>
  <script src="./resources/ol.js"></script>
  <script src="./resources/ol-layerswitcher.js"></script>
  <script src="resources/photon-geocoder-autocomplete.min.js"></script>

  <!-- LAYERS -->
  <script src="layers/KesesuaianUrbanAgriculture20_1.js"></script>
  <script src="layers/KesesuaianUrbanAgriculture10_2.js"></script>
  <script src="layers/BatasKabupaten_3.js"></script>
  <script src="styles/KesesuaianUrbanAgriculture20_1_style.js"></script>
  <script src="styles/KesesuaianUrbanAgriculture10_2_style.js"></script>
  <script src="styles/BatasKabupaten_3_style.js"></script>
  <script src="./layers/layers.js"></script>

  <script src="./resources/Autolinker.min.js"></script>

  <script>
    const baseGoogle = new ol.layer.Tile({
      title: 'Google Satelit',
      type: 'base',
      visible: true,
      source: new ol.source.XYZ({
        url: 'http://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}'
      })
    });

    const batasKabupaten = lyr_BatasKabupaten_3;
    batasKabupaten.setZIndex(10); // di atas satelit
    batasKabupaten.setStyle(new ol.style.Style({
      stroke: new ol.style.Stroke({
        color: '#000000',
        width: 2
      }),
      fill: null
    }));

    const ua10 = lyr_KesesuaianUrbanAgriculture10_2;
    const ua20 = lyr_KesesuaianUrbanAgriculture20_1;

    ua10.setVisible(true);
    ua20.setVisible(false);

    // Hover style (kuning transparan)
    const hoverStyle = new ol.style.Style({
      stroke: new ol.style.Stroke({
        color: 'yellow',
        width: 2
      }),
      fill: new ol.style.Fill({
        color: 'rgba(255, 255, 0, 0.3)'
      })
    });

    const map = new ol.Map({
      target: 'map',
      layers: [baseGoogle, batasKabupaten, ua10, ua20],
      view: new ol.View({
        center: ol.proj.fromLonLat([106.15, -2.5]), // Ganti jika perlu
        zoom: 11
      }),
      controls: ol.control.defaults().extend([
        new ol.control.LayerSwitcher({tipLabel: 'Layer', groupSelectStyle: 'children'})
      ])
    });

    // Hover interaction
    const selectPointerMove = new ol.interaction.Select({
      condition: ol.events.condition.pointerMove,
      style: hoverStyle,
      layers: [ua10, ua20]
    });
    map.addInteraction(selectPointerMove);

    // Legend (ganti ini sesuai kebutuhan)
    document.getElementById('legend').innerHTML = `
      <b>Kesesuaian Urban Agriculture 1.0</b><br>
      <span style="background-color:#1a9641; width:10px; height:10px; display:inline-block;"></span> Sangat Sesuai<br>
      <span style="background-color:#a6d96a; width:10px; height:10px; display:inline-block;"></span> Sesuai<br>
      <hr>
      <b>Kesesuaian Urban Agriculture 2.0</b><br>
      <span style="background-color:#fdae61; width:10px; height:10px; display:inline-block;"></span> Cukup Sesuai<br>
      <span style="background-color:#d7191c; width:10px; height:10px; display:inline-block;"></span> Tidak Sesuai
    `;
  </script>
</body>
</html>
